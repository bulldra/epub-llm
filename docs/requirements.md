# EPUB LLM システム要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
EPUB LLM - EPUBファイル対応AI質問応答システム

### 1.2 目的
EPUBファイルを活用した知識検索・質問応答システムを構築し、大量の書籍データから効率的に情報を抽出・回答を生成する。

### 1.3 対象範囲
- EPUBファイルのアップロード・管理
- テキスト抽出・埋め込みベクトル化
- 意味検索によるRAG（Retrieval-Augmented Generation）
- チャット形式での質問応答
- 会話履歴の管理
- MCP（Model Context Protocol）対応API

## 2. 機能要件

### 2.1 EPUBファイル管理機能
- **FR-001**: EPUBファイルのアップロード機能
- **FR-002**: EPUBファイルの削除機能
- **FR-003**: EPUBファイル一覧表示機能
- **FR-004**: EPUBメタデータ（タイトル、著者、出版年）表示機能
- **FR-005**: EPUBカバー画像表示機能
- **FR-006**: EPUBファイルのダウンロード機能

### 2.2 テキスト処理機能
- **FR-007**: EPUBファイルからのテキスト抽出機能
- **FR-008**: テキストのチャンク分割機能（4000文字、重複500文字）
- **FR-009**: 埋め込みベクトル生成機能（multilingual-e5-base-mlx使用）
- **FR-010**: 埋め込みベクトルのキャッシュ機能

### 2.3 検索・質問応答機能
- **FR-011**: 意味検索機能（FAISS使用）
- **FR-012**: RAGクエリ生成機能
- **FR-013**: LLMによる回答生成機能（Llama-4-Scout-17B使用）
- **FR-014**: ストリーミング形式での回答配信機能
- **FR-015**: 複数書籍での横断検索機能

### 2.4 ユーザーインターフェース機能
- **FR-016**: チャット形式のWebUI
- **FR-017**: 書籍一覧表示UI（本棚UI）
- **FR-018**: リアルタイム回答表示機能
- **FR-019**: 書籍選択機能

### 2.5 履歴管理機能
- **FR-020**: 会話履歴の保存機能
- **FR-021**: 会話履歴の読み込み機能
- **FR-022**: 会話履歴一覧表示機能
- **FR-023**: セッション管理機能

### 2.6 MCP対応機能
- **FR-024**: MCP対応API機能
- **FR-025**: EPUB一覧取得ツール
- **FR-026**: EPUBメタデータ取得ツール
- **FR-027**: EPUB内容検索ツール
- **FR-028**: 履歴管理ツール

## 3. 非機能要件

### 3.1 性能要件
- **NFR-001**: 埋め込みベクトル生成時間: 1チャンクあたり500ms以下
- **NFR-002**: 検索レスポンス時間: 1秒以下
- **NFR-003**: LLM初回応答時間: 5秒以下
- **NFR-004**: 同時接続数: 10ユーザー以下

### 3.2 品質要件
- **NFR-005**: システム可用性: 99%以上
- **NFR-006**: エラーログ記録機能
- **NFR-007**: 適切なエラーメッセージ表示

### 3.3 セキュリティ要件
- **NFR-008**: アップロードファイル形式チェック
- **NFR-009**: ファイルサイズ制限
- **NFR-010**: パス操作攻撃対策

### 3.4 運用要件
- **NFR-011**: ログファイル出力機能
- **NFR-012**: キャッシュファイル管理機能
- **NFR-013**: 設定ファイル管理機能

## 4. 技術要件

### 4.1 開発環境
- **Python 3.12以上**
- **FastAPI** - WebAPIフレームワーク
- **MLX** - AppleシリコンML最適化ライブラリ
- **FAISS** - 高速類似検索ライブラリ
- **FastMCP** - MCP対応フレームワーク

### 4.2 使用モデル
- **LLM**: lmstudio-community/Llama-4-Scout-17B-16E-MLX-text-4bit
- **埋め込みモデル**: mlx-community/multilingual-e5-base-mlx

### 4.3 依存ライブラリ
- ebooklib - EPUB処理
- numpy - 数値計算
- jinja2 - テンプレートエンジン
- uvicorn - ASGI サーバー

## 5. 制約事項

### 5.1 技術的制約
- AppleシリコンMac環境での動作を前提
- MLXライブラリに依存
- 日本語テキストに最適化

### 5.2 機能的制約
- EPUBファイルのみ対応
- 同時処理数に制限
- ローカル環境での動作

## 6. 想定ユーザー

### 6.1 主要ユーザー
- 研究者・学生
- 書籍を大量に扱う専門職
- 知識労働者

### 6.2 使用シーン
- 論文・書籍の調査研究
- 専門書からの情報抽出
- 複数書籍での横断的な情報検索

## 7. 成功基準

### 7.1 機能面
- EPUBファイルから正確な情報抽出ができる
- 適切な検索結果を返す
- 自然な日本語回答を生成する

### 7.2 性能面
- 実用的なレスポンス時間を実現
- 安定した動作を維持
- 効率的なリソース使用

### 7.3 運用面
- 簡単な導入・設定
- 適切なエラーハンドリング
- 保守性の高いコード構造