<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<title>EPUB Chat</title>
		<link rel="stylesheet" href="/static/style.css" />
		<script
			src="/static/vendor/marked.min.js"
			onerror="loadMarkedFallback()"></script>
		<script>
			// marked.jsのフォールバック機能
			function loadMarkedFallback() {
				console.warn(
					'ローカルのmarked.jsの読み込みに失敗しました。CDNから読み込みます。'
				)
				const script = document.createElement('script')
				script.src = 'https://cdn.jsdelivr.net/npm/marked/marked.min.js'
				script.onerror = function () {
					console.error(
						'marked.jsの読み込みに完全に失敗しました。Markdownレンダリングが利用できません。'
					)
				}
				document.head.appendChild(script)
			}
		</script>
		<script src="/static/chat.js" defer></script>
	</head>
	<body>
		<div id="main-layout">
			<aside id="sidebar">
				<div class="sidebar-header">
					<h2>チャット履歴</h2>
					<button
						id="new-chat-btn"
						class="new-chat-btn"
						title="新しいチャット">
						<svg
							width="16"
							height="16"
							viewBox="0 0 24 24"
							fill="none">
							<path
								d="M12 5V19M5 12H19"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round" />
						</svg>
						新規
					</button>
				</div>
				<ul id="history-list"></ul>
			</aside>
			<div id="chat-container">
				<div id="messages"></div>
				<div id="bottom-bar-container">
					<form id="chat-form" class="chat-form-row">
						<div class="input-icon-wrap">
							<button
								type="button"
								class="bookshelf-toggle icon-btn bookshelf-btn-inside"
								id="bookshelf-toggle"
								title="本棚から選択">
								<svg
									viewBox="0 0 24 24"
									width="24"
									height="24"
									fill="none">
									<g>
										<rect
											x="3"
											y="4"
											width="18"
											height="16"
											rx="2"
											fill="#22303c" />
										<rect
											x="6"
											y="7"
											width="12"
											height="2"
											rx="1"
											fill="#1da1f2" />
										<rect
											x="6"
											y="11"
											width="8"
											height="2"
											rx="1"
											fill="#1da1f2" />
									</g>
								</svg>
							</button>
							<span
								id="selected-books-list"
								class="selected-books-list floating-books-list"></span>
							<textarea
								id="question"
								placeholder="質問を入力..."
								required></textarea>
							<button
								type="submit"
								id="send-btn"
								title="送信"
								class="icon-btn send-btn-inside">
								<svg
									width="24"
									height="24"
									viewBox="0 0 24 24"
									fill="none"
									style="display: block">
									<path
										d="M2 21L23 12L2 3V10L17 12L2 14V21Z"
										stroke="#0b5cad"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										fill="none" />
								</svg>
							</button>
						</div>
					</form>
					<div id="status-area"></div>
					<div id="bookshelf-container">
						<button
							id="bookshelf-close"
							class="popup-close-btn"
							type="button"
							title="閉じる">
							×
						</button>
						<button
							id="bookshelf-select-all"
							class="popup-btn"
							type="button"
							title="全選択">
							全選択
						</button>
						<button
							id="bookshelf-clear-all"
							class="popup-btn"
							type="button"
							title="全解除">
							全解除
						</button>
						<div id="bookshelf" class="bookshelf-grid"></div>
						<div
							id="no-books"
							class="no-books"
							style="display: none">
							書籍が登録されてません
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
